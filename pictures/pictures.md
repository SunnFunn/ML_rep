### **Сравнительный анализ текста и чертежей pdf файлов**

[Проект](https://github.com/SunnFunn/ML_rep/tree/master/pictures) выполнен как web-приложение с интерфейсом, позволяющим регистрироваться предварительно авторизованным пользователем, загружать два файла pdf и получать результат постраничного сравнения текста и чертежей файлов. Результат скачивается по выдаваемым приложением ссылкам в форме pdf фалов с выделенными красными боксами местами, в которых найдена разница;

Интерфейсы регистрации пользователя, ввода текста и получения результатов сравнительного постраничного анализа pdf файлов представлены ниже на нескольких скриншотах. Проект является прориетарным, поэтому код проекта представлен небольшими фрагментами.

Скриншоты показывают:
> - страницу загрузки pdf файлов;
> - страницу установки параметров модели сравнения файлов (порог чувствительности энкодера, параметры выделения разностных областей на пиксельных картинках модуля python opencv и другие параметры);
> - страница с итогами анализа и ссылками на скачивание pdf страниц с найденными разницами, которые выделяются красными прямоугольниками;
> - два последних скриншота демонстрируют найденную разницу в pdf страницах.

![pictures](https://github.com/SunnFunn/ML_rep/blob/master/imgs/pictures.png)


![pictures_2](https://github.com/SunnFunn/ML_rep/blob/master/imgs/pictures_2.png)


![pictures_3](https://github.com/SunnFunn/ML_rep/blob/master/imgs/pictures_3.png)

![pictures_4_1](https://github.com/SunnFunn/ML_rep/blob/master/imgs/pictures_4_1.png)

![pictures_4_2](https://github.com/SunnFunn/ML_rep/blob/master/imgs/pictures_4_2.png)

Приложение развернуто в облаке в трех докер контейнерах : web-контейнер, контейнер flask-приложения с uWSGI сервером, контейнер "чистилщик", осуществляющий чистку временных файлов, полученных после сравнения pdf документов.
Контейнеры запускаются ерез конфигурацию в docker-compose.yml.

Приложение концептуально работает в следующей схеме:

> - загруженные файлы pdf разбиваются на отдельные страницы (используется модуль python pymupdf);
> - количество страниц в документах может быть разным, кроме того, страницы могут быть переставлены в своем порядке; по этой причине проводится постраничное сканирование на предмет расчета "расстояния" между отдельными страницами и ранжирование пар страниц по расстоянию. Далее удаляются страницы с наименьшим расстоянием.
> - на выходе номера выброшенных из анализа страниц указываются;
> - оставшиеся страницы анализируются в двух направлениях: если страница является текстовой, то проходит экстракция текста и сравнение текста библиотекой difflib; если страницы содержат чертежи, то происходит конвертация в jpeg картинку, посиск попиксельно разностных областей и пропуск их через энкодер нейросеть, а также сравнение текста difflib, если он есть;
> - далее определяются координаты найденных разностей и по этим координатам осуществляется отрисовка боксов, выделяющих разностные области двух pdf страниц;
> - в конце происходит склейка pdf страниц в единый документ с найденными разностями.
